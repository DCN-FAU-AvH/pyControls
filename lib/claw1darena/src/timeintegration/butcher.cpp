/*
  This file is part of claw1dArena, a software library to discretize
  one-dimensional conservation laws.

  Copyright (C) 2017 Matteo Semplice

  This program is free software; you can redistribute it and/or
  modify it under the terms of the GNU General Public License
  as published by the Free Software Foundation; either version 2
  of the License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program; if not, write to the Free Software
  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.

  For details on the licence, see the COPYING file at the root of the tree.
*/

/** @addtogroup timeintegration
 *
 * @{
 */

/*! \file butcher.cpp
 *  \brief Instantiation of ButcherTableaux for some useful methods and implementation of the getExplicitButcherTableaux functions
 */

#include "../config.h"
#include "butcher.tpp"
#include <cmath>

//! Tableaux of the Explicit Euler method
ExplicitButcherTableaux tableauxEuler(1,{1.0},1);

//! Tableaux of the Heun method
ExplicitButcherTableaux tableauxHeun(2,{1.0,0.5,0.5},2);

//! Tableaux of the order 3 SSP with 3 stages
ExplicitButcherTableaux tableauxSSP3(3,{1.0,0.25,0.25,1./6,1./6,2./3},3);

//! Tableaux of the order 4 classical Runge-Kutta with 4 stages
ExplicitButcherTableaux tableauxRunge4(
  4,{1./2,
     0,1./2,
     0,0,1.,
     1./6,1./3,1./3,1./6},
  4);

//! Tableaux of an order 5 Runge-Kutta with 6 stages
ExplicitButcherTableaux tableauxRK5(
  6,{1./2,
    3./16,1./16,
    0,0,1./2,
    0,-3./16,6./16,9./16,
    1./7,4./7,6./7,-12./7,8./7,
    7./90,0.,32./90,12./90,32./90,7./90},
  5);

//! Tableaux of an order 7 Runge-Kutta with 9 stages
ExplicitButcherTableaux tableauxRK7(
  9,{1./6,
    0,1./3,
    1./8,0.,3./8,
    148./1331,0.,150./1331,-56./1331,
    -404./243,0.,-170./27,4024./1701,10648./1701,
    2466./2401,0.,1242./343,-19176./16807,-51909./16807,1053./2401,
    5./154,0.,0.,96./539,-1815./20384,-405./2464,49./1144,
    -113./32,0.,-195./22,32./7,29403./3584,-729./512,1029./1408,21./16,
    0.,0.,0.,32./105,1771561./6289920,243./2560,16807./74880,77./1440,11./270},
  7);

tD sq21 = std::sqrt(21.);

//! Tableaux of an order 8 Runge-Kutta with 11 stages (see Butcher (2008), page 197)
ExplicitButcherTableaux tableauxRK8(
  11,{/*A(1,j)*/ 1./2,
      /*A(2,j)*/ 1./4,1./4,
      /*A(3,j)*/ 1./7,(-7.-3.*sq21)/98.,(21.+5*sq21)/49,
      /*A(4,j)*/ (11.+sq21)/84,0.,(18.+4*sq21)/63,(21.-sq21)/252,
      /*A(5,j)*/ (5.+sq21)/48,0.,(9.+sq21)/36,(-231.+14*sq21)/360,(63.-7*sq21)/80,
      /*A(6,j)*/ (10.-sq21)/42,0.,(-432.+92*sq21)/315,(633.-145*sq21)/90,(-504.+115*sq21)/70,(63.-13*sq21)/35,
      /*A(7,j)*/ 1./14,0,0,0,(14.-3*sq21)/126,(13.-3*sq21)/63,1./9,
      /*A(8,j)*/ 1./32,0.,0.,0.,(91.-21*sq21)/576,11./72,(-385.-75*sq21)/1152,(63.+13*sq21)/128,
      /*A(9,j)*/ 1./14,0.,0.,0.,1./9,(-733.-147*sq21)/2205,(515.+111*sq21)/504,(-51.-11*sq21)/56,(132.+28*sq21)/245,
      /*A(10,j)*/0.,0.,0.,0.,(-42.+7*sq21)/18,(-18.+28*sq21)/45,(-273.-53*sq21)/72,(301.+53*sq21)/72,(28.-28*sq21)/45,(49.-7*sq21)/18,
      /*b(j)  */ 1./20,0.,0.,0.,0.,0.,0.,49./180,16./45,49./180,1./20},
  8);

//! Tableaux of an order 8 Runge-Kutta with 11 stages (see Butcher (2008), page 197)
ExplicitButcherTableaux tableauxRK10(
  18,{/*A(2,1)*/ .1452518960316150517617548528770033320314511251329947060838468741983976455607179673401,
      /*A(3,1)*/ .7262594801580752588087742643850166601572556256649735304192343709919882278035898367003e-1,
      /*A(3,2)*/ .7262594801580752588087742643850166601572556256649735304192343709919882278035898367003e-1,
      /*A(4,1)*/ .5446946101185564441065806982887624951179417192487301478144257782439911708526923775252e-1,
      /*A(4,2)*/ 0.,
      /*A(4,3)*/ .1634083830355669332319742094866287485353825157746190443443277334731973512558077132576,
      /*A(5,1)*/ .5446946101185564441065806982887624951179417192487301478144257782439911708526923775252,
      /*A(5,2)*/ 0.,
      /*A(5,3)*/ -2.042604787944586665399677618582859356692281447182738054304096668414966890697596415720,
      /*A(5,4)*/ 2.042604787944586665399677618582859356692281447182738054304096668414966890697596415720,
      /*A(6,1)*/ .6536335321422677329278968379465149941415300630984761773773109338927894050232308530303e-1,
      /*A(6,2)*/ 0.,
      /*A(6,3)*/ 0.,
      /*A(6,4)*/ .3268167660711338664639484189732574970707650315492380886886554669463947025116154265151,
      /*A(6,5)*/ .2614534128569070931711587351786059976566120252393904709509243735571157620092923412121,
      /*A(7,1)*/ .8233707757482716585173454344310125296066814318521742241762319051772963627695955263034e-1,
      /*A(7,2)*/ 0.,
      /*A(7,3)*/ 0.,
      /*A(7,4)*/ .2119171963202803561687843468555305553175658807629274312902985594840086570224567152664,
      /*A(7,5)*/ -.3997343508054218311577932550061320162379840049816347807630118786107674477850206579628e-1,
      /*A(7,6)*/ .2037865317596006197606259822674324543477946306275935376058802473310199901934015124941e-1,
      /*A(8,1)*/ .8595305779007343831562027786771081909543936570474230618236291858949564375587825985001e-1,
      /*A(8,2)*/ 0.,
      /*A(8,3)*/ 0.,
      /*A(8,4)*/ 0.,
      /*A(8,5)*/ 0.,
      /*A(8,6)*/ .2911769478058850960337179621761553399856026049598393013981874594942289837064329700000,
      /*A(8,7)*/ .3964475145147024104912442607655312127779123206780991480607158892217361663405931088001,
      /*A(9,1)*/ .8612093485606967549983047372292119178898514571588438099912534616486575243508895957628e-1,
      /*A(9,2)*/ 0.,
      /*A(9,3)*/ 0.,
      /*A(9,4)*/ 0.,
      /*A(9,5)*/ 0.,
      /*A(9,6)*/ .1397464826824442089036313891001189801074425314582326737716288563521183595455090268480,
      /*A(9,7)*/ .3951098495815674599900526056001284215294125840404176924334653987770478924197803010468,
      /*A(9,8)*/ -.4079412703708563576307759281612056453162454270752418047326990081493640904820003348350e-1,
      /*A(10,1)*/ .7233144422337948077616348229119326315582930871089020733092900891206129381937795204778e-1,
      /*A(10,2)*/ 0.,
      /*A(10,3)*/ 0.,
      /*A(10,4)*/ 0.,
      /*A(10,5)*/ 0.,
      /*A(10,6)*/ .2200276284689998102140972735735070061373242800181187459951219347361114857342828430157,
      /*A(10,7)*/ .8789533425436734013369780264792573637952226487753296416823846876217040795688489371334e-1,
      /*A(10,8)*/ -.4445383996260350863990674880611108986832860648196030000580004690002268108984238641730e-1,
      /*A(10,9)*/ -.2183282289488754689095532966861839909872150913926337371522805434288481649401165594213,
      /*A(11,1)*/ .8947100936731114228785441966773836169071038390882857211057269158522704971585365845223e-1,
      /*A(11,2)*/ 0.,
      /*A(11,3)*/ 0.,
      /*A(11,4)*/ 0.,
      /*A(11,5)*/ 0.,
      /*A(11,6)*/ .3946008170285561860741397654755022300929434262701385530048127140223687993778661654316,
      /*A(11,7)*/ .3443011367963333487713764986067104675654371857504670290688086760696354596195596354011,
      /*A(11,8)*/ -.7946682664292661290694938113119430997053815140863772328764150866582492425892231395780e-1,
      /*A(11,9)*/ -.3915218947895966123834967996391962853380545808840091268064277812752553499114569444180,
      /*A(11,10)*/ 0.,
      /*A(12,1)*/  0.3210006877963209212945282736072241886741425314298532400216927262619488479186214523312e-1,
      /*A(12,2)*/  0.,
      /*A(12,3)*/  0.,
      /*A(12,4)*/  0.,
      /*A(12,5)*/  0.,
      /*A(12,6)*/  0.,
      /*A(12,7)*/  0.,
      /*A(12,8)*/ -.1846375997512050141835163881753227910996323204749769226655464078048769505209525299752e-3,
      /*A(12,9)*/  .1560894025313219860759149162557283383430181475726228517203663063649626288079337909898,
      /*A(12,10)*/ .1934496857654560252749984220385188727138526287670744309970093278715606577140084022992,
      /*A(12,11)*/ .2611612387636636496908928477536452288263163392010050661129958478089356710938164130987,
      /*A(13,1)*/   0.4423749328524996327035388417792688154433173133294892285295756457561276315648477233732e-1,
      /*A(13,2)*/   0.,
      /*A(13,3)*/   0.,
      /*A(13,4)*/   0.,
      /*A(13,5)*/   0.,
      /*A(13,6)*/   0.,
      /*A(13,7)*/   0.,
      /*A(13,8)*/    .4640774434539039636406222168781981616534115643208114455689698789119941732444857047798e-2,
      /*A(13,9)*/    .4704660282615136532130927218172390570903230981414159347904277946537920001824903276586e-1,
      /*A(13,10)*/   .8620749948011488160369445167416002799205317397013619044391270706339561700281526529703e-1,
      /*A(13,11)*/  -.2607983024682138093233254079066687623148682426317395111719299641390118652802949600035e-1,
      /*A(13,12)*/  -.3858020174396621532493277639159499581333235076531298977820093139813399390137768850940e-1,
      /*A(14,1)*/    .2318046717429411567006043539613275607940758021709332569729352990777336390158311630529e-1,
      /*A(14,2)*/   0.,
      /*A(14,3)*/   0.,
      /*A(14,4)*/   0.,
      /*A(14,5)*/   0.,
      /*A(14,6)*/   0.,
      /*A(14,7)*/   0.,
      /*A(14,8)*/    .3197856784116367067302124322582100058864027838197120089129330601737324659881765852593,
      /*A(14,9)*/    .5933233331841898686063939886797828376866051205773280426848164018120869674204443797948,
      /*A(14,10)*/ -1.937519548878479314706815782408229952008442222624773168771865465659822020582450444783,
      /*A(14,11)*/   .1803950557030502357344063195737827904476240180662764468232042537858892203518134072359,
      /*A(14,12)*/  -.4554014298857220726863505256926549022316460712353658688873150702827663762861750674926,
      /*A(14,13)*/  2.158764106255762807077594619172645539322916635447781333204724468181634037726021280742,
      /*A(15,1)*/   .2624364325798105891527733985858552391723553030719144065844544880498188553839263944447e-1,
      /*A(15,2)*/  0.,
      /*A(15,3)*/  0.,
      /*A(15,4)*/  0.,
      /*A(15,5)*/  0.,
      /*A(15,6)*/  0.,
      /*A(15,7)*/  0.,
      /*A(15,8)*/   .4863139423867266106526843913609225996253073727381961544415263239431571586043622332760e-1,
      /*A(15,9)*/   .4274382538346478867636942429421724367591866585774144180215122660980822123988151132213e-1,
      /*A(15,10)*/ -.4862259869465547771298976981868643277396586803130813159599600102115609499827986711663,
      /*A(15,11)*/  .1326047194917652331781527125743684254490968718259563958293167893998110899691451568372,
      /*A(15,12)*/ -.9402962152946515651634831658142934852383791641671387741034606371378082209616938685225e-1,
      /*A(15,13)*/  .6993864679941022534190304512277131176659196396138275832136258135631963192299339871223,
      /*A(15,14)*/ -.1197020013028860976492784934312243036670658451195397948726104511062042521592125912599e-1,
      /*A(16,1)*/    .5568066641536216461090823068917803436066365804361903532125349474551476120813558125830e-1,
      /*A(16,2)*/   0.,
      /*A(16,3)*/   0.,
      /*A(16,4)*/   0.,
      /*A(16,5)*/   0.,
      /*A(16,6)*/   0.,
      /*A(16,7)*/   0.,
      /*A(16,8)*/   -.4324853319508358432896036654421685136736530810118924113940744870078036705505610668088,
      /*A(16,9)*/   -.9979726994172038714656907882931844552238093285811791155499130927685987422432191170216,
      /*A(16,10)*/  2.707893755718926115778725270396739994070337972517006747100005607751792006959604868323,
      /*A(16,11)*/ -1.024823023512132929313567156576969954855232272749038347671818195935585095295127839150,
      /*A(16,12)*/  1.334565206642246959252239602313589265188981560552694580059808406200559397799055652161,
      /*A(16,13)*/ -2.587748998830690939658228913150922979184368065866213469477796089200252812362701917187,
      /*A(16,14)*/   .8992773696348355846430438306111181223414632598285854300924423251352733205187087732678e-1,
      /*A(16,15)*/  1.497578446211167333777988534023066333042434967475357134513165331964695787890042760189,
      /*A(17,1)*/   -.8434891199686377639125188391985671318383858641413517143104162188088468627447515172982e-3,
      /*A(17,2)*/   0.,
      /*A(17,3)*/   0.,
      /*A(17,4)*/   0.,
      /*A(17,5)*/   0.,
      /*A(17,6)*/   0.,
      /*A(17,7)*/   0.,
      /*A(17,8)*/    .7602144218856081893754106886111596435015500427480120290148318740899211421773423234728,
      /*A(17,9)*/   1.769083927820959377467464871522349066447068428702073590698445112684989184432409492025,
      /*A(17,10)*/ -4.499239797622297101452915424261016593995695456495268863455643396071539024609271033574,
      /*A(17,11)*/  1.490558190212043468817221563278239942209691100326719140478588601720867838040211450448,
      /*A(17,12)*/ -2.552203480132132516997563217309689292804518121743365818482497611667126218719069737195,
      /*A(17,13)*/  4.795167551528575994217413424533259845001657006088189480440731104737960266616292993321,
      /*A(17,14)*/  -.9161854401769482236671414092387917470686251714192236693920061138984202381209109248553e-1,
      /*A(17,15)*/ -1.525735678746850818217653470352135651821164556169070505816135230784807058389577753184,
      /*A(17,16)*/   .7371445601564892133467497107205798584829803038168267854389817508169123996459113657504,
      /*A(18,1)*/    .1017366974111576638766809656369828971944080018220332809259398740674738807023371082700,
      /*A(18,2)*/   0.,
      /*A(18,3)*/   0.,
      /*A(18,4)*/   0.,
      /*A(18,5)*/   0.,
      /*A(18,6)*/   0.,
      /*A(18,7)*/   0.,
      /*A(18,8)*/  -1.696217553209432810711666838709742166182992092906177246174096517233561845662947862824,
      /*A(18,9)*/  -3.825235846211624254528740857512255693551264719132875740261231165548583482101116676418,
      /*A(18,10)*/  9.754768979885866648856431516333641627109105703674164986615824197909762854575668793816,
      /*A(18,11)*/ -2.520767789227152291196336314591227486393143379933686189126240710041836742414125694941,
      /*A(18,12)*/  5.472417145227780046950992000565734793413395536531652419585004300790370984185945495978,
      /*A(18,13)*/ -9.781098113458736121002383874108051372067873053264954833376114258940736444388841687929,
      /*A(18,14)*/   .3189152692455334369024560213486753019540464785641163242047782111839399471147176681561,
      /*A(18,15)*/  3.447227036527756718156475010324322155277035924051392880570525223655410460762027138915,
      /*A(18,16)*/  -.6051983612219277832241707671295607127814820499715293613761402732652780120810041653591,
      /*A(18,17)*/   .3334525350307787459202631378414806560287636505658634784117511174230383993073398823363,
      /*b(1)*/   .3333333333333333333333333333333333333333333333333333333333333333333333333333333333333e-1,
      /*b(2)*/   0.,
      /*b(3)*/   0.,
      /*b(4)*/   0.,
      /*b(5)*/   0.,
      /*b(6)*/   0.,
      /*b(7)*/   0.,
      /*b(8)*/   0.,
      /*b(9)*/   0.,
      /*b(10)*/  0.,
      /*b(11)*/  0.,
      /*b(12)*/ .1387145942588715882541801312803271702142521598590204181697361204933422401935856968980,
      /*b(13)*/ .1892374781489234901583064041060123262381623469486258303271944256799821862794952728707,
      /*b(14)*/ .9461873907446174507915320205300616311908117347431291516359721283999109313974763643533e-1,
      /*b(15)*/ .2774291885177431765083602625606543404285043197180408363394722409866844803871713937960,
      /*b(16)*/ .1387145942588715882541801312803271702142521598590204181697361204933422401935856968980,
      /*b(17)*/ .9461873907446174507915320205300616311908117347431291516359721283999109313974763643533e-1,
      /*b(18)*/ .3333333333333333333333333333333333333333333333333333333333333333333333333333333333333e-1
      },
  10);

//! \brief Return an explicit Butcher Tableaux, given its ERKtype
template <>
ExplicitButcherTableaux & getExplicitButcherTableaux(ERKtype type){
  switch (type){
  case ERK_euler:
    return (tableauxEuler);
    break;
  case ERK_heun:
    return (tableauxHeun);
    break;
  case ERK_ssp3:
    return (tableauxSSP3);
    break;
  case ERK_runge4:
    return (tableauxRunge4);
    break;
  case ERK_rk5:
    return (tableauxRK5);
    break;
  case ERK_rk7:
    return (tableauxRK7);
    break;
  case ERK_rk8:
    return (tableauxRK8);
    break;
  case ERK_rk10:
    return (tableauxRK10);
    break;
  default:
    std::cout << "Unknown tableaux type " << type << ". Aborting"<<std::endl;
    abort();
  }
}

//! \brief Return an appropriate explicit Butcher Tableaux of a given order
template<>
ExplicitButcherTableaux & getExplicitButcherTableaux(int order){
  switch (order){
  case 1:
    return (tableauxEuler);
    break;
  case 2:
    return (tableauxHeun);
    break;
  case 3:
    return (tableauxSSP3);
    break;
  case 4:
    return (tableauxRunge4);
    break;
  case 5:
    return (tableauxRK5);
    break;
  case 6:
  case 7:
    return (tableauxRK7);
    break;
  case 8:
    return (tableauxRK8);
    break;
  case 9:
  case 10:
    return (tableauxRK10);
    break;
  default:
    std::cout << "Unknown tableaux for order " << order << ". Aborting"<<std::endl;
    abort();
  }
}

/** @} */
